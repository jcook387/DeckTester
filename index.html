<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG Deck Tester</title>
    <link rel="stylesheet" href="styles.css">
    <script src="function.js" defer></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>MTG Deck Tester</h1>
            <p>Build and test your deck before you buy</p>
        </header>

        <div class="main-layout">
            <button class="deck-builder-toggle" onclick="toggleDeckBuilder()">üìù Deck Builder</button>

            <aside class="deck-builder" id="deckBuilder">
                <div class="deck-builder-header">
                    <h2>Deck Builder</h2>
                    <button class="close-deck-builder" onclick="toggleDeckBuilder()">√ó</button>
                </div>
                
                <div class="add-card-form">
                    <div class="form-group">
                        <label>Card Name</label>
                        <input type="text" id="cardName" placeholder="Search for a card..." autocomplete="off">
                        <div id="autocompleteDropdown" class="autocomplete-dropdown" style="display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>Type</label>
                        <select id="cardType">
                            <option value="Creature">Creature</option>
                            <option value="Instant">Instant</option>
                            <option value="Sorcery">Sorcery</option>
                            <option value="Enchantment">Enchantment</option>
                            <option value="Artifact">Artifact</option>
                            <option value="Planeswalker">Planeswalker</option>
                            <option value="Land">Land</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Mana Cost (e.g., 2R, 1UU, 3)</label>
                        <input type="text" id="manaCost" placeholder="1R">
                    </div>
                    
                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="quantity" value="1" min="1" max="4">
                    </div>
                    
                    <button onclick="addCard()">Add to Deck</button>
                </div>

                <div class="deck-stats">
                    <div class="stat-item">
                        <strong>Total Cards:</strong>
                        <span id="totalCards">0</span>
                    </div>
                    <div class="stat-item">
                        <strong>Creatures:</strong>
                        <span id="creatureCount">0</span>
                    </div>
                    <div class="stat-item">
                        <strong>Spells:</strong>
                        <span id="spellCount">0</span>
                    </div>
                    <div class="stat-item">
                        <strong>Lands:</strong>
                        <span id="landCount">0</span>
                    </div>
                    <div class="stat-item">
                        <strong>Avg CMC:</strong>
                        <span id="avgCMC">0.0</span>
                    </div>
                </div>

                <div class="decklist" id="decklist">
                    <!-- Cards will appear here -->
                </div>

                <div class="import-export">
                    <h3>Import/Export</h3>
                    <textarea id="decklistText" placeholder="Paste decklist here (format: 4 Lightning Bolt)
For Commander format: 1 *Commander Name* (with asterisks)"></textarea>
                    <div class="button-group">
                        <button onclick="importDeckWithFeedback()">Import</button>
                        <button onclick="exportDeck()" class="btn-secondary">Export</button>
                        <button onclick="clearDeck()" class="btn-danger">Clear Deck</button>
                    </div>
                    <div id="importStatus" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
                    <div style="margin-top: 10px; font-size: 11px; color: #888; font-style: italic;">
                        üí° Tip: Surround commander name with asterisks (*Commander Name*) or put "Commander:" label to auto-set
                    </div>
                </div>
            </aside>

            <main class="play-area">
                <div class="top-controls">
                    <button onclick="startGame()">üé≤ New Game</button>
                    <button onclick="mulligan()">üîÑ Mulligan</button>
                    <button onclick="drawCard()">üì§ Draw</button>
                    <button onclick="showMillPrompt()" class="mill-button">‚ö∞Ô∏è Mill</button>
                    <button onclick="openLibrarySearch()" class="btn-secondary">üîç Search Library</button>
                    <button onclick="runSimulation()" class="btn-secondary">üìä Simulate</button>
                    <button onclick="resetGame()" class="btn-secondary">‚Ü∫ Reset</button>
                </div>

                <div class="card-preview-modal" id="cardPreviewModal" onclick="closeCardPreview()">
                    <div class="card-preview-content" onclick="event.stopPropagation()">
                        <button class="card-preview-close" onclick="closeCardPreview()">‚úï Close</button>
                        <div id="cardPreviewImageContainer"></div>
                    </div>
                </div>

                <div class="library-search-modal" id="librarySearchModal">
                    <div class="library-search-content" onclick="event.stopPropagation()">
                        <div class="library-search-header">
                            <h3>üîç Search Library</h3>
                            <button onclick="closeLibrarySearch()" class="btn-danger">‚úï Close</button>
                        </div>
                        <input 
                            type="text" 
                            id="librarySearchInput" 
                            class="library-search-input" 
                            placeholder="Search for a card..."
                            oninput="filterLibraryCards()"
                        >
                        <div id="libraryCardsGrid" class="library-cards-grid"></div>
                    </div>
                </div>

                <div class="mulligan-tracker" id="mulliganTracker" style="display: none; position: fixed; top: 140px; left: 50%; transform: translateX(-50%); background: rgba(255,243,205,0.95); z-index: 50;">
                    Mulligans: <span id="mulliganCount">0</span> | 
                    Hand: <span id="handSize">0</span> | 
                    Library: <span id="librarySize">0</span> | 
                    Graveyard: <span id="graveyardSize">0</span>
                </div>

                <div class="life-tracker">
                    <div class="life-tracker-header">‚ù§Ô∏è Life Total</div>
                    <div class="life-total-display">
                        <div class="life-total-value" id="lifeTotal">40</div>
                    </div>
                    <div class="life-controls">
                        <button class="life-btn gain" onclick="modifyLife(1)">+1</button>
                        <button class="life-btn lose" onclick="modifyLife(-1)">-1</button>
                        <button class="life-btn gain" onclick="modifyLife(5)">+5</button>
                        <button class="life-btn lose" onclick="modifyLife(-5)">-5</button>
                    </div>
                    <button class="life-reset-btn" onclick="resetLife()">Reset to 40</button>
                </div>

                <div class="mana-pool">
                    <div class="mana-pool-title">
                        <span>Mana Pool</span>
                        <button class="clear-mana-btn" onclick="clearManaPool()">Clear</button>
                    </div>
                    <div class="mana-display" id="manaDisplay">
                        <div class="mana-type" onclick="addMana('W')" title="Click to add White mana">
                            <div class="mana-symbol mana-white">W</div>
                            <span id="manaW">0</span>
                        </div>
                        <div class="mana-type" onclick="addMana('U')" title="Click to add Blue mana">
                            <div class="mana-symbol mana-blue">U</div>
                            <span id="manaU">0</span>
                        </div>
                        <div class="mana-type" onclick="addMana('B')" title="Click to add Black mana">
                            <div class="mana-symbol mana-black">B</div>
                            <span id="manaB">0</span>
                        </div>
                        <div class="mana-type" onclick="addMana('R')" title="Click to add Red mana">
                            <div class="mana-symbol mana-red">R</div>
                            <span id="manaR">0</span>
                        </div>
                        <div class="mana-type" onclick="addMana('G')" title="Click to add Green mana">
                            <div class="mana-symbol mana-green">G</div>
                            <span id="manaG">0</span>
                        </div>
                        <div class="mana-type" onclick="addMana('C')" title="Click to add Colorless mana">
                            <div class="mana-symbol mana-colorless">C</div>
                            <span id="manaC">0</span>
                        </div>
                    </div>
                </div>

                <div class="command-zone">
                    <div class="command-zone-header">‚öîÔ∏è Command Zone</div>
                    <div class="commander-tax">
                        <div class="commander-tax-label">Commander Tax</div>
                        <div class="commander-tax-value" id="commanderTax">0</div>
                        <div class="commander-tax-cost" id="commanderTaxCost">+{0} to cast</div>
                    </div>
                    <div class="command-zone-cards" id="commandZoneCards">
                        <div class="command-zone-empty">No commander set</div>
                    </div>
                    <button class="set-commander-btn" onclick="setCommanderFromHand()">Set from Hand</button>
                </div>

                <div class="library-counter">
                    <div class="library-counter-title">Library</div>
                    <div class="library-counter-value" id="libraryCount">0</div>
                </div>

                <div class="graveyard-exile-area">
                    <div class="mini-zone">
                        <div class="mini-zone-header">
                            <span>Graveyard</span>
                            <span class="mini-zone-count" id="graveyardCount">0</span>
                        </div>
                        <div class="mini-cards" id="graveyardMini"></div>
                    </div>
                </div>

                <div class="battlefield-area">
                    <div class="battlefield-main" id="battlefieldMain">
                        <div class="zone-label">Creatures & Permanents</div>
                    </div>
                    <div class="battlefield-lands" id="battlefieldLands">
                        <div class="zone-label">Lands</div>
                    </div>
                </div>

                <div class="hand-area">
                    <div class="hand-label">
                        <span>Hand</span>
                        <span class="mini-zone-count" id="handCount">0</span>
                    </div>
                    <div class="cards-container" id="hand"></div>
                </div>

                <div class="sample-hands" id="sampleHands" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; max-width: 800px; max-height: 80vh; overflow-y: auto; z-index: 200; box-shadow: 0 8px 32px rgba(0,0,0,0.4);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Sample Hand Analysis</h3>
                        <button onclick="document.getElementById('sampleHands').style.display='none'" style="background: #dc3545;">Close</button>
                    </div>
                    <div id="sampleHandsContent"></div>
                </div>

                <button class="help-toggle" onclick="toggleKeyboardHelp()">‚å®Ô∏è Shortcuts</button>

                <div id="manaSelector" class="mana-selector">
                    <div class="mana-selector-title" id="manaSelectorTitle">Choose Mana Type</div>
                    <div class="mana-selector-grid">
                        <div class="mana-selector-option" onclick="selectManaColor('W')">
                            <div class="mana-symbol mana-white">W</div>
                            <div class="mana-selector-label">White</div>
                        </div>
                        <div class="mana-selector-option" onclick="selectManaColor('U')">
                            <div class="mana-symbol mana-blue">U</div>
                            <div class="mana-selector-label">Blue</div>
                        </div>
                        <div class="mana-selector-option" onclick="selectManaColor('B')">
                            <div class="mana-symbol mana-black">B</div>
                            <div class="mana-selector-label">Black</div>
                        </div>
                        <div class="mana-selector-option" onclick="selectManaColor('R')">
                            <div class="mana-symbol mana-red">R</div>
                            <div class="mana-selector-label">Red</div>
                        </div>
                        <div class="mana-selector-option" onclick="selectManaColor('G')">
                            <div class="mana-symbol mana-green">G</div>
                            <div class="mana-selector-label">Green</div>
                        </div>
                        <div class="mana-selector-option" onclick="selectManaColor('C')">
                            <div class="mana-symbol mana-colorless">C</div>
                            <div class="mana-selector-label">Colorless</div>
                        </div>
                    </div>
                    <button class="mana-selector-close" onclick="closeManaSelector()">Cancel</button>
                </div>

                <div id="counterManager" class="counter-manager">
                    <div class="counter-manager-title" id="counterManagerTitle">Manage Counters</div>
                    
                    <div class="counter-type-selector">
                        <button class="counter-type-btn" onclick="selectCounterType('plus-one')">+1/+1</button>
                        <button class="counter-type-btn" onclick="selectCounterType('minus-one')">-1/-1</button>
                        <button class="counter-type-btn" onclick="selectCounterType('loyalty')">Loyalty</button>
                        <button class="counter-type-btn" onclick="selectCounterType('charge')">Charge</button>
                        <button class="counter-type-btn" onclick="selectCounterType('custom')">Custom</button>
                    </div>

                    <div id="customCounterInput" style="display: none;">
                        <input type="text" class="counter-custom-input" id="customCounterName" placeholder="Enter counter name...">
                    </div>

                    <div class="counter-controls">
                        <button class="counter-btn remove" onclick="modifyCounter(-1)">‚àí</button>
                        <div class="counter-value" id="currentCounterValue">0</div>
                        <button class="counter-btn" onclick="modifyCounter(1)">+</button>
                    </div>

                    <button class="counter-manager-close" onclick="closeCounterManager()">Done</button>
                </div>

                <div class="keyboard-help" id="keyboardHelp">
                    <h4>‚å®Ô∏è Keyboard Shortcuts</h4>
                    <div class="shortcut-item">
                        <span class="shortcut-key">SPACE</span>
                        <span class="shortcut-desc">Next Turn</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">C</span>
                        <span class="shortcut-desc">Cast/Set Commander</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">D</span>
                        <span class="shortcut-desc">Draw Card</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">T</span>
                        <span class="shortcut-desc">Tap Last Card</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">F</span>
                        <span class="shortcut-desc">Flip Last Card</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">U</span>
                        <span class="shortcut-desc">Untap All</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">X</span>
                        <span class="shortcut-desc">Mill Cards</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">L</span>
                        <span class="shortcut-desc">Search Library</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">N</span>
                        <span class="shortcut-desc">New Game</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">M</span>
                        <span class="shortcut-desc">Mulligan</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">R</span>
                        <span class="shortcut-desc">Reset Game</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">B</span>
                        <span class="shortcut-desc">Toggle Deck Builder</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">S</span>
                        <span class="shortcut-desc">Simulate Hands</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">ESC</span>
                        <span class="shortcut-desc">Close Panels</span>
                    </div>
                    <hr style="margin: 10px 0; border-color: #444;">
                    <div style="margin-top: 10px; font-size: 11px; color: #aaa;">
                        <strong>Card Actions:</strong><br>
                        ‚Ä¢ Single-click ‚Üí Preview<br>
                        ‚Ä¢ Double-click hand ‚Üí Play<br>
                        ‚Ä¢ Double-click land ‚Üí Tap for mana<br>
                        ‚Ä¢ Double-click other ‚Üí Tap/untap<br>
                        ‚Ä¢ Shift + Double-click creature/artifact ‚Üí Tap for mana<br>
                        ‚Ä¢ Click üîÑ button ‚Üí Flip card<br>
                        ‚Ä¢ Right-click ‚Üí Menu (includes counters)<br>
                        ‚Ä¢ Drag & drop ‚Üí Move<br><br>
                        <strong>Mana Pool:</strong><br>
                        ‚Ä¢ Double-click lands ‚Üí Taps & adds mana<br>
                        ‚Ä¢ Basic lands ‚Üí Auto-detect color<br>
                        ‚Ä¢ Non-basic lands ‚Üí Choose color<br>
                        ‚Ä¢ Click mana symbols ‚Üí Manually add mana<br>
                        ‚Ä¢ Playing spells ‚Üí Auto-spends mana<br>
                        ‚Ä¢ Next turn (SPACE) ‚Üí Clears pool<br><br>
                        <strong>Commander:</strong><br>
                        ‚Ä¢ Click commander ‚Üí Cast<br>
                        ‚Ä¢ Right-click ‚Üí Options<br>
                        ‚Ä¢ Right-click battlefield commander ‚Üí Return to Command Zone<br><br>
                        <strong>Graveyard:</strong><br>
                        ‚Ä¢ Click ‚Üí View card<br>
                        ‚Ä¢ Right-click ‚Üí Return to hand
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>
</html>